<%= render 'shared/flash' %>

<div class="flex justify-between items-center mb-4">
  <h1 class="text-2xl font-bold"><%= t("account_memberships.title") %> - <%= @account.name %></h1>
  <%= render ViewButtonComponent.new(path: @account, label: t("account_memberships.back_to_account"), color: :gray) %>
</div>

<h2 class="text-xl font-semibold mb-4"><%= t("account_memberships.add_member_title") %></h2>
<%= form_with url: account_account_memberships_path(@account), local: true, class: "mb-6 p-4 border rounded" do |f| %>
  <div class="mb-4">
    <%= f.label :email_address, t("account_memberships.email_address"), class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.email_field :email_address, required: true, class: "w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" %>
  </div>
  <div class="mb-4">
    <%= f.label :role, "Role", class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.select :role, [['Member', 'member'], ['Owner', 'owner']], {}, { class: "w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" } %>
  </div>
  <%= f.submit t("account_memberships.add_member"), class: "px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600" %>
<% end %>

<h2 class="text-xl font-semibold mb-4">Current Members</h2>
<table class="min-w-full bg-white border">
  <thead>
    <tr class="bg-gray-100">
      <th class="px-4 py-2 text-left">Name</th>
      <th class="px-4 py-2 text-left">Email</th>
      <th class="px-4 py-2 text-left">Role</th>
      <th class="px-4 py-2 text-left">Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @memberships.each do |membership| %>
      <tr class="border-t">
        <td class="px-4 py-2"><%= membership.user.name %></td>
        <td class="px-4 py-2"><%= membership.user.email_address %></td>
        <td class="px-4 py-2">
          <%= form_with url: account_account_membership_path(@account, membership), method: :patch, local: true, class: "inline" do |f| %>
            <%= f.select :role, [[t("account_memberships.member"), 'member'], [t("account_memberships.owner"), 'owner']], { selected: membership.role }, 
                { 
                  onchange: "this.form.submit()",
                  disabled: (membership.owner? && @account.account_memberships.owners.count == 1),
                  class: "px-2 py-1 border rounded text-sm"
                } %>
          <% end %>
        </td>
        <td class="px-4 py-2">
          <% unless membership.owner? && @account.account_memberships.owners.count == 1 %>
            <%= link_to t("account_memberships.remove"), account_account_membership_path(@account, membership), 
                method: :delete,
                data: { confirm: t("shared.confirm_remove_member", name: membership.user.name) },
                class: "px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600" %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

