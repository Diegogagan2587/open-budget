<h1 class="text-2xl font-bold mb-4">Link to Planned Expense</h1>

<p class="mb-4">Link "<%= @shopping_item.name %>" to an existing planned expense.</p>

<% if @planned_expenses.empty? %>
  <div class="bg-yellow-50 border border-yellow-200 text-yellow-700 px-4 py-3 rounded mb-4">
    <p>No unlinked planned expenses found.</p>
  </div>
<% else %>
  <%= form_with url: link_to_planned_expense_shopping_item_path(@shopping_item), method: :patch, local: true do |form| %>
    <div class="mb-4">
      <%= form.label :planned_expense_id, "Planned Expense", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.collection_select :planned_expense_id, @planned_expenses, :id, 
          lambda { |pe| "#{pe.description} - #{number_to_currency(pe.amount)} (#{pe.income_event.description})" }, 
          { prompt: "Select a planned expense" }, 
          { class: "border rounded px-3 py-2 w-full", required: true } %>
    </div>

    <div class="mb-4">
      <%= form.submit "Link", class: "px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600" %>
      <%= link_to "Cancel", @shopping_item, class: "px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 ml-2" %>
    </div>
  <% end %>
<% end %>

