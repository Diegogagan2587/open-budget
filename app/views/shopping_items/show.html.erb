<p style="color: green"><%= notice %></p>

<div class="mb-4">
  <%= link_to "â† Back to Shopping List", shopping_items_path, class: "text-blue-500 hover:underline" %>
</div>

<h1 class="text-2xl font-bold mb-4"><%= @shopping_item.name %></h1>

<div class="mb-4 flex space-x-2">
  <%= render EditButtonComponent.new(path: edit_shopping_item_path(@shopping_item)) %>
  <%= render DeleteButtonComponent.new(
    path: @shopping_item,
    confirm_message: "Are you sure?"
  ) %>
  <% if @shopping_item.status == "pending" %>
    <%= link_to "Mark as Purchased", mark_as_purchased_shopping_item_path(@shopping_item), 
        data: { turbo_method: :patch }, 
        class: "px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors" %>
  <% end %>
</div>

<div class="bg-gray-50 p-4 rounded mb-4">
  <h2 class="text-xl font-semibold mb-2">Details</h2>
  <div class="grid grid-cols-2 gap-4">
    <div>
      <p class="text-sm text-gray-600">Status</p>
      <p class="font-semibold">
        <span class="px-2 py-1 rounded text-xs <%= @shopping_item.status == 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800' %>">
          <%= @shopping_item.status.humanize %>
        </span>
      </p>
    </div>
    <div>
      <p class="text-sm text-gray-600">Type</p>
      <p class="font-semibold">
        <span class="px-2 py-1 rounded text-xs bg-gray-100 text-gray-800">
          <%= @shopping_item.item_type.humanize %>
        </span>
      </p>
    </div>
    <div>
      <p class="text-sm text-gray-600">Category</p>
      <p class="font-semibold"><%= @shopping_item.category&.name || "-" %></p>
    </div>
    <div>
      <p class="text-sm text-gray-600">Quantity</p>
      <p class="font-semibold"><%= @shopping_item.quantity || "-" %></p>
    </div>
    <div>
      <p class="text-sm text-gray-600">Estimated Amount</p>
      <p class="font-semibold"><%= @shopping_item.estimated_amount ? number_to_currency(@shopping_item.estimated_amount) : "-" %></p>
    </div>
    <% if @shopping_item.item_type == "recurring" %>
      <div>
        <p class="text-sm text-gray-600">Frequency</p>
        <p class="font-semibold"><%= @shopping_item.frequency || "-" %></p>
      </div>
      <div>
        <p class="text-sm text-gray-600">Last Purchased</p>
        <p class="font-semibold"><%= @shopping_item.last_purchased_at ? @shopping_item.last_purchased_at.strftime("%B %d, %Y") : "-" %></p>
      </div>
    <% end %>
    <% if @shopping_item.notes.present? %>
      <div class="col-span-2">
        <p class="text-sm text-gray-600">Notes</p>
        <p class="font-semibold"><%= @shopping_item.notes %></p>
      </div>
    <% end %>
  </div>
</div>

<% if @shopping_item.planned_expense %>
  <div class="bg-blue-50 p-4 rounded mb-4">
    <h2 class="text-xl font-semibold mb-2">Linked Planned Expense</h2>
    <p><%= link_to @shopping_item.planned_expense.description, income_event_planned_expense_path(@shopping_item.planned_expense.income_event, @shopping_item.planned_expense), class: "text-blue-500 hover:underline" %></p>
  </div>
<% end %>

<% if @shopping_item.expense %>
  <div class="bg-blue-50 p-4 rounded mb-4">
    <h2 class="text-xl font-semibold mb-2">Linked Expense</h2>
    <p><%= link_to @shopping_item.expense.description, @shopping_item.expense, class: "text-blue-500 hover:underline" %></p>
  </div>
<% end %>

<div class="bg-white border p-4 rounded mb-4">
  <h2 class="text-xl font-semibold mb-2">Budget Integration</h2>
  <div class="flex flex-col gap-2">
    <%= link_to "Convert to Planned Expense", convert_to_planned_expense_shopping_item_path(@shopping_item), 
        class: "px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors text-center" %>
    <%= link_to "Convert to Expense", convert_to_expense_shopping_item_path(@shopping_item), 
        class: "px-4 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600 transition-colors text-center" %>
    <%= link_to "Link to Planned Expense", link_to_planned_expense_shopping_item_path(@shopping_item), 
        class: "px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors text-center" %>
  </div>
</div>

