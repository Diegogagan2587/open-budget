<p style="color: green"><%= notice %></p>

<div class="container mx-auto px-4">
  <h1 class="text-2xl font-bold mb-4"><%= t("shopping_items.index.title") %></h1>

  <div class="mb-6 flex flex-col sm:flex-row gap-3 sm:gap-0 sm:justify-between sm:items-center">
    <%= render AddButtonComponent.new(
        label: t("shopping_items.index.add_item"),
        path: new_shopping_item_path
      ) %>

    <div class="flex flex-wrap gap-2">
      <%= link_to t("shopping_items.index.pending"), shopping_items_path(status: "pending"),
          class: "px-3 py-1.5 rounded #{@status_filter == 'pending' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}" %>
      <%= link_to t("shopping_items.index.purchased"), shopping_items_path(status: "purchased"),
          class: "px-3 py-1.5 rounded #{@status_filter == 'purchased' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}" %>
      <%= link_to t("shopping_items.index.all"), shopping_items_path(status: "all"),
          class: "px-3 py-1.5 rounded #{@status_filter == 'all' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}" %>
    </div>
  </div>

  <% if @grouped_shopping_items.any? %>
    <div class="space-y-8">
      <% @grouped_shopping_items.each do |category, items| %>
        <section>
          <h2 class="text-lg font-semibold text-gray-800 mb-3 pb-2 border-b border-gray-200">
            <%= category ? category.name : t("shopping_items.index.uncategorized") %>
          </h2>
          <div class="space-y-4">
            <% items.each do |shopping_item| %>
              <div class="bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-200 border border-gray-200 overflow-hidden">
                <div class="p-6">
                  <div class="flex flex-wrap items-center gap-2 mb-3">
                    <%= link_to shopping_item.name, shopping_item, class: "text-lg font-semibold text-gray-900 hover:text-blue-600 hover:underline" %>
                    <span class="px-2 py-1 rounded text-xs <%= shopping_item.status == 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800' %>">
                      <%= t("activerecord.attributes.shopping_item.status_options.#{shopping_item.status}") %>
                    </span>
                    <span class="px-2 py-1 rounded text-xs bg-gray-100 text-gray-800">
                      <%= t("activerecord.attributes.shopping_item.item_type.#{shopping_item.item_type}") %>
                    </span>
                  </div>
                  <p class="text-sm text-gray-600 mb-4">
                    <%= shopping_item.category&.name || "-" %> · <%= shopping_item.quantity.presence || "-" %> · <%= shopping_item.estimated_amount ? number_to_currency(shopping_item.estimated_amount) : "-" %>
                  </p>
                  <div class="flex flex-wrap gap-2 items-center justify-start">
                    <%= link_to t("shared.view"), shopping_item, class: "inline-flex items-center justify-center px-4 py-2 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600 transition-colors" %>
                    <%= link_to t("shared.edit"), edit_shopping_item_path(shopping_item), class: "inline-flex items-center justify-center px-4 py-2 bg-gray-200 text-gray-700 text-sm rounded-lg hover:bg-gray-300 transition-colors" %>
                    <% if shopping_item.status == "pending" %>
                      <%= link_to t("shopping_items.index.mark_purchased"), mark_as_purchased_shopping_item_path(shopping_item),
                          data: { turbo_method: :patch },
                          class: "inline-flex items-center justify-center px-4 py-2 bg-green-500 text-white text-sm rounded-lg hover:bg-green-600 transition-colors" %>
                    <% end %>
                    <%= button_to t("shared.delete"), shopping_item, method: :delete, data: { turbo_confirm: t("shared.confirm_destroy") }, class: "inline-flex items-center justify-center px-4 py-2 bg-red-500 text-white text-sm rounded-lg hover:bg-red-600 transition-colors" %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </section>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-12">
      <p class="text-gray-500"><%= t("shopping_items.index.empty") %></p>
    </div>
  <% end %>
</div>
